<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Front-End Final Project" />
    <meta
      name="keywords"
      content="HTML, CSS, JavaScript, Front-End, Website, UI"
    />
    <meta name="author" content="Gvantsa Nadiradze" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Courses - eLearn</title>
    <link rel="stylesheet" href="styles/reset.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;700;800&family=Krona+One&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <a href="./index.html" class="logo">eLearn</a>

      <input type="checkbox" name="nav-burger-btn" id="nav-burger-btn" />

      <label class="nav-burger menu-icon" for="nav-burger-btn"
        ><i class="fas fa-bars"></i
      ></label>

      <nav class="nav">
        <ul class="nav-ul">
          <li><a href="./index.html" class="nav-link">Home</a></li>
          <span class="nav-separator">|</span>
          <li><a href="./courses.html" class="nav-link">Courses</a></li>
          <span class="nav-separator">|</span>
          <li>
            <a href="./login.html" id="navUserLink" class="nav-link">Login</a>
          </li>
          <li>
            <a href="./cart.html" class="cart-icon cart-icon-mobile menu-icon"
              ><i class="fas fa-shopping-cart"></i
            ></a>
          </li>
        </ul>
      </nav>

      <a href="./cart.html" class="cart-icon menu-icon">
        <i class="fas fa-shopping-cart"></i>
      </a>
    </header>

    <main class="main-content">
      <div class="container">
        <h1 class="page-title">Courses</h1>

        <div class="courses-grid" id="coursesGrid">
          <p style="text-align: center; width: 100%">Loading courses...</p>
        </div>
      </div>
    </main>

    <script src="./scripts/script.js"></script>
    <script>
      const coursesGrid = document.getElementById("coursesGrid");

      // Valid Wikipedia Page Titles for better image results
      const topics = [
        "Computer network",
        "CCNA",
        "Internet Protocol Suite", // TCP/IP
        "Network security",
        "Routing protocol",
        "Wireless network",
        "System administrator", // Network admin
        "Network architecture",
        "Cloud computing",
        "Firewall (computing)",
        "Virtual private network",
        "Network monitoring",
        "Network virtualization",
        "Cybersecurity",
      ];

      async function loadCourses() {
        // Use Promise.all to fetch all topics in parallel
        const requests = topics.map(
          (topic) =>
            fetch(
              `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`,
            )
              .then((res) => {
                if (!res.ok) throw new Error("Not found");
                return res.json();
              })
              .catch((err) => null), // Return null on error so one failure doesn't stop everything
        );

        const results = await Promise.all(requests);

        // Filter out failed requests (null)
        const courses = results.filter((data) => data && data.title);

        displayCourses(courses);
      }

      function displayCourses(courses) {
        if (!courses.length) {
          coursesGrid.innerHTML = "<p>No courses found.</p>";
          return;
        }

        coursesGrid.innerHTML = courses
          .map((course) => {
            // Check if a thumbnail exists, otherwise use a default icon
            const imageHtml = `<img src="images/${course.title}.png" alt="${course.title}" style="width: 100%; height: 100%; object-fit: cover;">`;
            return `
            <div class="course-card" onclick="goToCourseDetails('${course.title.replace(/'/g, "\\'")}')">
                <div class="course-card-image" style="overflow: hidden;">
                    ${imageHtml}
                </div>
                <div class="course-card-info">
                    <h3 class="course-card-name">${course.title}</h3>
                    <p class="course-card-desc">${course.extract ? course.extract.substring(0, 100) + "..." : "No description available."}</p>
                </div>
            </div>
        `;
          })
          .join("");
      }

      document.addEventListener("DOMContentLoaded", function () {
        updateUserName();
        loadCourses();
      });
    </script>
  </body>
</html>
